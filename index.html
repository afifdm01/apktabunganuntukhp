<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TabunganKu - Dompet Digital Pribadi</title>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="index.css" />
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <div class="header">
      <div class="app-bar">
        <div class="app-title">TabunganKu</div>
        <div class="icon-button" title="Menu">
          <i class="fas fa-bars"></i>
        </div>
      </div>

      <div class="balance-card">
        <div class="balance-label">Sisa Saldo Anda</div>
        <div class="balance-amount" id="saldo">Rp 0</div>
        <div class="balance-actions">
          <button class="action-button" onclick="scrollToHistory()">
            <a href="#history" style="pointer-events:none;">Lihat Detail</a>
          </button>
          <button class="action-button" id="btnBagikan">
            <i class="fas fa-share"></i> Bagikan
          </button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="transaction-form fade-in">
        <div class="input-group">
          <label class="input-label" for="jumlah">Jumlah (Rp)</label>
          <input
            type="number"
            id="jumlah"
            class="input-field"
            placeholder="Masukkan jumlah"
            min="0"
          />
        </div>

        <div class="input-group">
          <label class="input-label" for="keterangan">Keterangan</label>
          <input
            type="text"
            id="keterangan"
            class="input-field"
            placeholder="Tambahkan keterangan transaksi"
          />
        </div>

        <div class="button-group">
          <button class="btn btn-primary" id="btnTambah">
            <i class="fas fa-plus-circle"></i> Tambah
          </button>
          <button class="btn btn-secondary" id="btnKurangi">
            <i class="fas fa-minus-circle"></i> Kurangi
          </button>
        </div>
      </div>

      <div class="history-section" id="history">
        <h2 class="section-title">
          Riwayat Transaksi
          <button class="btn-hapus-semua" id="btnHapusSemua" title="Hapus Semua Transaksi">
            <i class="fas fa-trash-alt"></i> Hapus Semua
          </button>
        </h2>
        <div class="history-list" id="daftarHistori">
          <div class="empty-history">
            <i class="fas fa-receipt"></i>
            <p>Belum ada transaksi</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>Â© 2025 TabunganKu - By Kreator Dzaxz</p>
    </div>
  </div>

  <script>
    // Data aplikasi
    let saldo = Number(localStorage.getItem('tabunganSaldo')) || 0;
    let histori = JSON.parse(localStorage.getItem('tabunganHistori')) || [];

    // Elemen DOM
    const elemenSaldo = document.getElementById('saldo');
    const inputJumlah = document.getElementById('jumlah');
    const inputKeterangan = document.getElementById('keterangan');
    const btnTambah = document.getElementById('btnTambah');
    const btnKurangi = document.getElementById('btnKurangi');
    const daftarHistori = document.getElementById('daftarHistori');
    const btnHapusSemua = document.getElementById('btnHapusSemua');
    const btnBagikan = document.getElementById('btnBagikan');

    // Format angka ke Rupiah
    function formatRupiah(angka) {
      return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0,
      }).format(angka);
    }

    // Perbarui tampilan saldo
    function perbaruiSaldo() {
      elemenSaldo.textContent = formatRupiah(saldo);
      localStorage.setItem('tabunganSaldo', saldo);
    }

    // Simpan histori ke localStorage
    function simpanHistori() {
      localStorage.setItem('tabunganHistori', JSON.stringify(histori));
    }

    // Perbarui tampilan histori
    function perbaruiTampilanHistori() {
      if (histori.length === 0) {
        daftarHistori.innerHTML = `
          <div class="empty-history">
            <i class="fas fa-receipt"></i>
            <p>Belum ada transaksi</p>
          </div>
        `;
        return;
      }

      daftarHistori.innerHTML = '';

      histori.forEach((transaksi) => {
        const itemHistori = document.createElement('div');
        itemHistori.className = `history-item ${transaksi.jenis} fade-in`;

        const icon = transaksi.jenis === 'income' ? 'fa-arrow-down' : 'fa-arrow-up';
        const sign = transaksi.jenis === 'income' ? '+' : '-';

        itemHistori.innerHTML = `
          <div class="history-info">
            <div class="history-icon">
              <i class="fas ${icon}"></i>
            </div>
            <div class="history-details">
              <div class="history-title">${transaksi.keterangan}</div>
              <div class="history-date">${transaksi.tanggal}</div>
            </div>
          </div>
          <div class="history-amount">
            ${sign} ${formatRupiah(transaksi.jumlah)}
            <button class="btn-hapus" title="Hapus Transaksi" data-id="${transaksi.id}">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        `;

        daftarHistori.appendChild(itemHistori);
      });

      // Tambah event listener hapus tiap tombol hapus
      const tombolHapus = daftarHistori.querySelectorAll('.btn-hapus');
      tombolHapus.forEach((btn) => {
        btn.addEventListener('click', (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          hapusTransaksi(id);
        });
      });
    }

    // Fungsi tambah transaksi
    function tambahTransaksi(jumlah, keterangan) {
      if (jumlah <= 0) {
        alert('Jumlah harus lebih dari 0');
        return false;
      }
      if (!keterangan.trim()) {
        alert('Keterangan tidak boleh kosong');
        return false;
      }

      const tanggal = new Date().toLocaleString('id-ID', {
        dateStyle: 'short',
        timeStyle: 'short',
      });

      const transaksi = {
        id: Date.now().toString(),
        jenis: 'income',
        jumlah,
        keterangan,
        tanggal,
      };

      saldo += jumlah;
      histori.unshift(transaksi);
      perbaruiSaldo();
      simpanHistori();
      perbaruiTampilanHistori();

      return true;
    }

    // Fungsi kurangi transaksi (pengeluaran)
    function kurangiTransaksi(jumlah, keterangan) {
      if (jumlah <= 0) {
        alert('Jumlah harus lebih dari 0');
        return false;
      }
      if (!keterangan.trim()) {
        alert('Keterangan tidak boleh kosong');
        return false;
      }
      if (jumlah > saldo) {
        alert('Saldo tidak cukup untuk pengeluaran ini');
        return false;
      }

      const tanggal = new Date().toLocaleString('id-ID', {
        dateStyle: 'short',
        timeStyle: 'short',
      });

      const transaksi = {
        id: Date.now().toString(),
        jenis: 'expense',
        jumlah,
        keterangan,
        tanggal,
      };

      saldo -= jumlah;
      histori.unshift(transaksi);
      perbaruiSaldo();
      simpanHistori();
      perbaruiTampilanHistori();

      return true;
    }

    // Hapus transaksi berdasarkan id
    function hapusTransaksi(id) {
      const index = histori.findIndex((item) => item.id === id);
      if (index === -1) return;

      // Update saldo sesuai jenis transaksi yang dihapus
      if (histori[index].jenis === 'income') {
        saldo -= histori[index].jumlah;
      } else if (histori[index].jenis === 'expense') {
        saldo += histori[index].jumlah;
      }

      histori.splice(index, 1);
      perbaruiSaldo();
      simpanHistori();
      perbaruiTampilanHistori();
    }

    // Hapus semua transaksi
    btnHapusSemua.addEventListener('click', () => {
      const konfirmasi = confirm('Yakin ingin menghapus semua transaksi?');
      if (!konfirmasi) return;

      saldo = 0;
      histori = [];
      perbaruiSaldo();
      simpanHistori();
      perbaruiTampilanHistori();
    });

    // Scroll ke bagian history
    function scrollToHistory() {
      document.getElementById('history').scrollIntoView({ behavior: 'smooth' });
    }

    // Event tombol tambah
    btnTambah.addEventListener('click', () => {
      const jumlah = Number(inputJumlah.value);
      const keterangan = inputKeterangan.value;

      if (tambahTransaksi(jumlah, keterangan)) {
        inputJumlah.value = '';
        inputKeterangan.value = '';
      }
    });

    // Event tombol kurangi
    btnKurangi.addEventListener('click', () => {
      const jumlah = Number(inputJumlah.value);
      const keterangan = inputKeterangan.value;

      if (kurangiTransaksi(jumlah, keterangan)) {
        inputJumlah.value = '';
        inputKeterangan.value = '';
      }
    });

    // Bagikan saldo dan histori ke clipboard
    btnBagikan.addEventListener('click', () => {
      let teks = `Saldo saya saat ini: ${formatRupiah(saldo)}\nRiwayat Transaksi:\n`;
      if (histori.length === 0) {
        teks += 'Belum ada transaksi.';
      } else {
        histori.forEach((t) => {
          const sign = t.jenis === 'income' ? '+' : '-';
          teks += `${t.tanggal} | ${t.keterangan} | ${sign} ${formatRupiah(t.jumlah)}\n`;
        });
      }

      navigator.clipboard.writeText(teks).then(() => {
        alert('Data berhasil disalin! Silakan bagikan ke teman atau simpan.');
      }).catch(() => {
        alert('Gagal menyalin data. Coba lagi.');
      });
    });

    // Inisialisasi saat load halaman
    function init() {
      perbaruiSaldo();
      perbaruiTampilanHistori();
    }

    window.onload = init;
  </script>
</body>
</html>
